# 작업자 친화적인 실시간 불량 예측 모델 개발

## 프로젝트 개요

본 프로젝트는 제4회 K-인공지능 제조데이터 분석 경진대회에 제출된 "작업자 친화적인 실시간 불량 예측 모델 개발" 프로젝트입니다. 데이터 제공 기업은 일일 또는 주간 단위로 품질 이슈 현황을 파악하고 있으며 불량 원인을 수작업으로 분석하고 있어, 즉각적인 대응이 가능하도록 제조 공정의 데이터를 분석하여 pass와 fail을 예측하는 프로그램을 개발했습니다.

## 주조 공정 소개

다이캐스팅법은 '다이(Die)'라고 불리는 금형에 금속 용탕을 고압으로 주입하여 정밀한 주물을 짧은 시간 내에 대량 생산합니다. Semi-solid 다이캐스팅법은 용융 금속에 전단 응력을 가해 반응고 상태에서 주조하는 방식으로, 이 과정에서 전자 교반을 활용하므로 해당 공정은 Rheocasting 방식입니다.

**다이캐스팅의 장점:**
1. 생산된 제품의 완성도가 높아 추가 가공이 거의 필요 없음
2. 비용이 저렴하여 생산 속도가 빠름

## 공정 문제 현황

- 경험에 의존한 설비 운용이 많아 체계적인 공정 관리 시스템이 부족하며, 데이터 기반의 예측 관리가 잘 이루어지지 않음
- 데이터 제공기업은 일일 또는 주간 단위로 품질 이슈 현황을 파악하고 있으며 불량원인을 수작업으로 분석하고 있음
- 주조 공정은 노동집약적, 기술자산 비중이 높지 않은 특성을 보이며 특히 세계적인 추세와 다르게 우리나라는 선진국 대비 낮은 인당 생산량 등의 문제를 안고 있음

**공정 외 문제 현황:**
- AI기술 도입을 위한 초기 투자 비용과 전문 인력 필요
- 필요 데이터 수집을 위한 환경 설정과 테스트 데이터 검증 후 실제 수집까지 시간 소요
- AI에 대한 이해 부족과 도입 후 기대할 수 있는 투자 수익률에 대한 불확실성

## 데이터 분석 및 전처리

- **데이터 개요**: 총합 2,852,465개(행 92,015개, 열 31개)의 데이터로 구성
- **수집 방법**: 주조 설비 내 PLC
- **수집 기간**: 2019년 01월 02일 ~ 2019년 03월 31일
- **품질 지수**: 전처리 전 약 79.216%로 '보통' 등급으로 평가됨

**전처리 과정:**
1. 결측치 제거
   - passorfail에서 발생한 1개의 결측치 제거
   - heating_furnace와 molten_volume이 모두 없는 경우(2.46%) 제거
   - tryshot_signal은 장비가 준비되지 않았을 때 발생하는 신호로, 정상 상태에서는 발생하지 않으므로 'NO'로 채움
   - lower_mold_temp3, upper_mold_temp3, molten_temp의 결측치(최대 2.5%)는 mold_code별 최빈값으로 대체

2. 유의하지 않은 데이터 제거
   - 고유값을 가지는 line, name, mold_name, emergency_stop 컬럼 제거
   - time, date, registration_time은 데이터 분석에 유의미하지 않다고 판단하여 제거

3. 문자형 데이터 인코딩
   - OrdinalEncoder를 통해 Object 타입의 데이터를 숫자로 인코딩

4. 이상치 제거
   - LocalOutlierFactor(LOF) 방식을 이용하여 이상치 제거
   - 공정상의 극단적 이상치 제거를 위해 n_neighbors=10으로 설정

5. 양품집단과 불량집단간의 T-test
   - t-검정을 통해 각 변수의 pass와 fail 그룹 간 평균 차이를 비교
   - p-value가 0.05보다 작은 경우, 두 그룹 간에 유의미한 차이가 있다고 판단
   - 검정 결과 '설비작동사이클시간', '상금형온도3'은 제거

6. 학습-평가 데이터 분리
   - 훈련 세트와 테스트 세트를 8:2 비율로 분리
   - 두 집단 모두에서 pass와 fail의 비율이 균등하게 유지되도록 조정

## 모델 개발

데이터 특성을 고려하여 XGBoost, LightGBM, CatBoost를 베이스 모델로 하는 VotingClassifier를 활용한 앙상블 기법을 설계했습니다.

**모델 선정 이유:**
- 데이터셋 전처리 결과, 21개의 변수 중 16개 변수에서 치우침이 발생하였고, 그 중 11개 변수는 매우 강한 치우침을 보임
- 비모수적 방법인 트리 기반 모델이 적합하다고 판단
- Pass와 Fail의 클래스 불균형이 심하기 때문에 CatBoost와 같은 불균형 데이터 처리에 강한 모델 선정

**모델 학습:**
- 각 베이스모델에 대해 랜덤 서치를 통해 최적의 하이퍼파라미터 선정
- VotingClassifier에서 catboost:1.0, lightGBM:2.5, XGB:1.0의 가중치로 학습 진행
- Pass, Fail의 클래스 불균형이 심하기 때문에 accuracy보다는 Fail 클래스에 대한 F1-score를 중점으로 평가

## 분석 결과 및 시사점

- 최종 모델은 테스트 데이터셋에서 F1-score 96.5%의 예측률을 보여줌
- 불량 예측에 많은 영향을 미치는 주요 인자는 cast_pressure, low_section_speed, biscuit_thickness, upper_mold_temp1 등
- 공정 또는 장비 문제를 의미하는 tryshot_signal 변수가 불량 예측에 상당한 영향을 주는 중요한 요소로 나타남
- 장비 재가동 후 안정화까지 5~6회의 작업이 필요한 것을 확인하여, 장비의 정상화를 위한 Dummy 작업 제안

## 중소제조기업에 미치는 파급효과

1. **손쉬운 사용을 통해 다양한 공정에 적용**
   - 코드를 함수화하여 사용자가 코딩 지식 없이도 변수만 변경하면 다양한 공정에 쉽게 적용할 수 있도록 프로그램 개발

2. **업무 환경 개선**
   - 품질관리를 공정 데이터를 통해 예측함으로써 품질 관리 및 유지보수 개선
   - 중소 기업의 제조 경쟁력 강화 및 지속적인 성장 지원

3. **생산성 증가 및 품질 관리 비용 절감**
   - 공정 최적화를 통한 비용 절감 및 생산/출시 기간 단축
   - AI 기반 품질 검사를 통한 불량률 최소화 및 검사 시간 단축
   - 설비의 고장 패턴 분석을 통한 예방적 유지보수로 비용 절감
   - 데이터 기반 불량 원인 파악으로 시행착오 감소 및 효율성 증대
